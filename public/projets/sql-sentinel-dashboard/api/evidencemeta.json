{"queries":[{"id":"risk_summary","compiledQueryString":"SELECT\n    COUNT(*) AS total_trades,\n    COUNT(DISTINCT user_id) AS unique_users,\n    SUM(amount * price) AS total_volume,\n    AVG(amount * price) AS avg_trade_size,\n    SUM(CASE WHEN status = 'failed' THEN 1 ELSE 0 END) AS failed_trades\nFROM sentinel.transactions","inputQueryString":"SELECT\n    COUNT(*) AS total_trades,\n    COUNT(DISTINCT user_id) AS unique_users,\n    SUM(amount * price) AS total_volume,\n    AVG(amount * price) AS avg_trade_size,\n    SUM(CASE WHEN status = 'failed' THEN 1 ELSE 0 END) AS failed_trades\nFROM sentinel.transactions","compiled":false,"inline":true},{"id":"wash_events","compiledQueryString":"WITH suspicious_pairs AS (\n  SELECT\n    a.user_id,\n    a.asset_id,\n    a.price,\n    ABS(EXTRACT(EPOCH FROM (b.timestamp - a.timestamp))) AS sec_diff\n  FROM sentinel.transactions a\n  INNER JOIN sentinel.transactions b\n    ON a.user_id = b.user_id\n    AND a.asset_id = b.asset_id\n    AND a.price = b.price\n    -- SÃ©curitÃ© build Svelte : b > a Ã©vite l'interprÃ©tation de balise HTML\n    AND b.trade_id > a.trade_id\n  WHERE a.status = 'completed' AND b.status = 'completed'\n)\nSELECT\n    user_id,\n    asset_id,\n    COUNT(*) AS wash_count,\n    AVG(sec_diff) AS avg_time_gap\nFROM suspicious_pairs\n-- SÃ©curitÃ© build : 10 > sec_diff remplace sec_diff < 10\nWHERE 10 > sec_diff\nGROUP BY ALL\nORDER BY wash_count DESC\nLIMIT 20","inputQueryString":"WITH suspicious_pairs AS (\n  SELECT\n    a.user_id,\n    a.asset_id,\n    a.price,\n    ABS(EXTRACT(EPOCH FROM (b.timestamp - a.timestamp))) AS sec_diff\n  FROM sentinel.transactions a\n  INNER JOIN sentinel.transactions b\n    ON a.user_id = b.user_id\n    AND a.asset_id = b.asset_id\n    AND a.price = b.price\n    -- SÃ©curitÃ© build Svelte : b > a Ã©vite l'interprÃ©tation de balise HTML\n    AND b.trade_id > a.trade_id\n  WHERE a.status = 'completed' AND b.status = 'completed'\n)\nSELECT\n    user_id,\n    asset_id,\n    COUNT(*) AS wash_count,\n    AVG(sec_diff) AS avg_time_gap\nFROM suspicious_pairs\n-- SÃ©curitÃ© build : 10 > sec_diff remplace sec_diff < 10\nWHERE 10 > sec_diff\nGROUP BY ALL\nORDER BY wash_count DESC\nLIMIT 20","compiled":false,"inline":true},{"id":"slippage_summary","compiledQueryString":"WITH trade_prices AS (\n  SELECT\n    t.asset_id,\n    ABS(t.price - m.market_price) / NULLIF(m.market_price, 0) AS slippage_pct\n  FROM sentinel.transactions t\n  INNER JOIN sentinel.market_prices m\n    ON t.asset_id = m.asset_id\n    AND DATE_TRUNC('minute', t.timestamp) = m.timestamp\n  WHERE t.status = 'completed'\n)\nSELECT\n    asset_id,\n    COUNT(*) AS trades,\n    AVG(slippage_pct) AS avg_slippage_pct\nFROM trade_prices\n-- SÃ©curitÃ© build : 0.1 > slippage_pct (filtre les outliers > 10%)\nWHERE 0.1 > slippage_pct\nGROUP BY ALL\nORDER BY avg_slippage_pct DESC","inputQueryString":"WITH trade_prices AS (\n  SELECT\n    t.asset_id,\n    ABS(t.price - m.market_price) / NULLIF(m.market_price, 0) AS slippage_pct\n  FROM sentinel.transactions t\n  INNER JOIN sentinel.market_prices m\n    ON t.asset_id = m.asset_id\n    AND DATE_TRUNC('minute', t.timestamp) = m.timestamp\n  WHERE t.status = 'completed'\n)\nSELECT\n    asset_id,\n    COUNT(*) AS trades,\n    AVG(slippage_pct) AS avg_slippage_pct\nFROM trade_prices\n-- SÃ©curitÃ© build : 0.1 > slippage_pct (filtre les outliers > 10%)\nWHERE 0.1 > slippage_pct\nGROUP BY ALL\nORDER BY avg_slippage_pct DESC","compiled":false,"inline":true},{"id":"spikes","compiledQueryString":"WITH windowed_volume AS (\n  SELECT\n    DATE_TRUNC('minute', timestamp) AS window_start,\n    SUM(amount) AS volume,\n    AVG(SUM(amount)) OVER (ORDER BY DATE_TRUNC('minute', timestamp) RANGE BETWEEN INTERVAL '24 hours' PRECEDING AND CURRENT ROW) AS mean_24h,\n    STDDEV(SUM(amount)) OVER (ORDER BY DATE_TRUNC('minute', timestamp) RANGE BETWEEN INTERVAL '24 hours' PRECEDING AND CURRENT ROW) AS std_24h\n  FROM sentinel.transactions\n  WHERE status = 'completed'\n  GROUP BY 1\n)\nSELECT\n    window_start,\n    volume,\n    volume / NULLIF(mean_24h, 0) AS volume_ratio\nFROM windowed_volume\nWHERE volume > (mean_24h + 3 * std_24h)\nORDER BY volume_ratio DESC\nLIMIT 15","inputQueryString":"WITH windowed_volume AS (\n  SELECT\n    DATE_TRUNC('minute', timestamp) AS window_start,\n    SUM(amount) AS volume,\n    AVG(SUM(amount)) OVER (ORDER BY DATE_TRUNC('minute', timestamp) RANGE BETWEEN INTERVAL '24 hours' PRECEDING AND CURRENT ROW) AS mean_24h,\n    STDDEV(SUM(amount)) OVER (ORDER BY DATE_TRUNC('minute', timestamp) RANGE BETWEEN INTERVAL '24 hours' PRECEDING AND CURRENT ROW) AS std_24h\n  FROM sentinel.transactions\n  WHERE status = 'completed'\n  GROUP BY 1\n)\nSELECT\n    window_start,\n    volume,\n    volume / NULLIF(mean_24h, 0) AS volume_ratio\nFROM windowed_volume\nWHERE volume > (mean_24h + 3 * std_24h)\nORDER BY volume_ratio DESC\nLIMIT 15","compiled":false,"inline":true},{"id":"risk_scores","compiledQueryString":"WITH user_metrics AS (\n  SELECT\n    user_id,\n    COUNT(*) AS trade_count,\n    SUM(amount * price) AS total_volume\n  FROM sentinel.transactions\n  WHERE status = 'completed'\n  GROUP BY user_id\n),\nstats AS (\n  SELECT\n    *,\n    (trade_count - AVG(trade_count) OVER()) / NULLIF(STDDEV(trade_count) OVER(), 0) AS z_score\n  FROM user_metrics\n)\nSELECT\n    user_id,\n    trade_count,\n    ROUND(total_volume) AS volume_total,\n    CASE\n      WHEN z_score > 2 THEN 'ðŸ”´ CRITIQUE'\n      WHEN z_score > 1 THEN 'ðŸŸ  Ã‰LEVÃ‰'\n      ELSE 'ðŸŸ¢ NORMAL'\n    END AS risk_level\nFROM stats\nORDER BY trade_count DESC\nLIMIT 25","inputQueryString":"WITH user_metrics AS (\n  SELECT\n    user_id,\n    COUNT(*) AS trade_count,\n    SUM(amount * price) AS total_volume\n  FROM sentinel.transactions\n  WHERE status = 'completed'\n  GROUP BY user_id\n),\nstats AS (\n  SELECT\n    *,\n    (trade_count - AVG(trade_count) OVER()) / NULLIF(STDDEV(trade_count) OVER(), 0) AS z_score\n  FROM user_metrics\n)\nSELECT\n    user_id,\n    trade_count,\n    ROUND(total_volume) AS volume_total,\n    CASE\n      WHEN z_score > 2 THEN 'ðŸ”´ CRITIQUE'\n      WHEN z_score > 1 THEN 'ðŸŸ  Ã‰LEVÃ‰'\n      ELSE 'ðŸŸ¢ NORMAL'\n    END AS risk_level\nFROM stats\nORDER BY trade_count DESC\nLIMIT 25","compiled":false,"inline":true},{"id":"daily_volume","compiledQueryString":"SELECT\n  DATE(timestamp) AS day,\n  SUM(amount * price) AS volume\nFROM sentinel.transactions\nWHERE status = 'completed'\nGROUP BY 1\nORDER BY 1","inputQueryString":"SELECT\n  DATE(timestamp) AS day,\n  SUM(amount * price) AS volume\nFROM sentinel.transactions\nWHERE status = 'completed'\nGROUP BY 1\nORDER BY 1","compiled":false,"inline":true}]}